<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>F1 Ontology Viewer - Catalog / Query (YASGUI)</title>

  <link rel="stylesheet" href="/vendor/yasgui/yasgui.min.css" />

  <style>
    :root {
      --ink: #0f172a;
      --muted: #586170;
      --border: #d6d8dd;
      --paper: #ffffff;
      --surface: #f4f2ef;
      --accent: #c2662d;
      --accent-dark: #8e4316;
      --shadow: 0 12px 32px rgba(15, 23, 42, 0.12);
    }
    html, body {
      height: 100%;
      margin: 0;
      background:
        var(--surface);
      color: var(--ink);
    }
    body {
      font-family: "Source Sans Pro", "Gill Sans", "Trebuchet MS", sans-serif;
    }
    .wrap {
      width: min(1180px, calc(100% - 32px));
      margin: 0 auto;
      padding: 18px 0 20px;
    }

    #topbar {
      background: var(--paper);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 18px 20px;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      animation: rise 420ms ease-out both;
    }
    #topbar::after {
      content: "";
      position: absolute;
      inset: auto -40px 12px auto;
      width: 120px;
      height: 120px;
      pointer-events: none;
    }
    #titleRow {
      display: flex;
      gap: 16px;
      align-items: baseline;
      flex-wrap: wrap;
    }
    #titleRow h1 {
      font-family: "Iowan Old Style", "Palatino Linotype", "Book Antiqua", Palatino, serif;
      font-size: clamp(20px, 1.2vw + 16px, 26px);
      margin: 0;
      font-weight: 700;
      letter-spacing: 0.2px;
    }
    #subtitle {
      color: var(--muted);
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 1.3px;
    }
    #intro {
      margin-top: 10px;
      color: #1f2937;
      font-size: 14px;
      line-height: 1.5;
      max-width: 980px;
    }
    #navlinks {
      margin-top: 14px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 13px;
    }
    #navlinks a {
      text-decoration: none;
      border: 1px solid var(--border);
      padding: 7px 12px;
      border-radius: 999px;
      color: var(--ink);
      background: #fff;
      transition: transform 120ms ease, border-color 120ms ease;
    }
    #navlinks a:hover {
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    #presets {
      margin-top: 16px;
      padding: 14px;
      background: #fff8f1;
      border: 1px solid #e9d2bf;
      border-radius: 14px;
      box-shadow: 0 8px 20px rgba(194, 102, 45, 0.12);
      animation: rise 520ms ease-out both;
      animation-delay: 80ms;
    }
    #presetsTitle {
      font-weight: 700;
      margin-bottom: 8px;
      font-size: 14px;
      color: #6b3a1a;
    }
    #status {
      margin-top: 10px;
      white-space: pre-wrap;
      font-family: "IBM Plex Mono", "Consolas", "Courier New", monospace;
      font-size: 12px;
      color: var(--muted);
    }

    #qtable {
      width: 100%;
      border-collapse: collapse;
      background: #ffffff;
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
    }
    #qtable th, #qtable td {
      padding: 12px 12px;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
      font-size: 13px;
    }
    #qtable th {
      background: #f3f4f6;
      text-align: left;
      font-weight: 700;
      color: #111827;
    }
    #qtable tr:last-child td { border-bottom: none; }

    .copyBtn {
      cursor: pointer;
      border: 1px solid var(--accent);
      background: var(--accent);
      color: #fff;
      padding: 7px 12px;
      border-radius: 999px;
      font-size: 13px;
      transition: transform 120ms ease, background 120ms ease;
    }
    .copyBtn:hover {
      background: var(--accent-dark);
      transform: translateY(-1px);
    }
    .smallMuted { color: var(--muted); font-size: 12px; }

    #yasgui {
      height: calc(100vh - 240px);
      min-height: 520px;
      width: min(1180px, calc(100% - 32px));
      margin: 0 auto;
      padding-top: 12px;
      animation: fadeIn 520ms ease-out both;
      animation-delay: 140ms;
    }

    @keyframes rise {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @media (max-width: 720px) {
      #yasgui {
        height: calc(100vh - 320px);
        width: calc(100% - 20px);
      }
      #topbar { padding: 16px; }
      #presets { padding: 12px; }
      #qtable th:nth-child(2),
      #qtable td:nth-child(2) { display: none; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div id="topbar">
      <div id="titleRow">
        <h1>F1 Ontology Viewer - Catalog / Query (YASGUI)</h1>
        <div id="subtitle">Viktória Terebová & Martin Krivosudský</div>
      </div>

      <div id="intro">
        This page lets you explore the <strong>Formula 1 ontology</strong> loaded in your local Apache Jena Fuseki dataset.
        The ontology models key concepts such as <em>constructors</em>, <em>drivers</em>, <em>circuits</em>, and <em>team entries</em>,
        and connects them with properties (for example, a team entry has drivers and is entered by a constructor).
        Use the prepared queries below as examples, then edit them to explore your data.
      </div>

      <div id="navlinks">
        <a href="/catalog.html">Catalog / Query</a>
        <a href="http://localhost:3030/" target="_blank" rel="noreferrer">Open Fuseki UI</a>
      </div>

      <div id="presets">
        <div id="presetsTitle">Prepared queries (click Copy, then paste into YASGUI)</div>

        <table id="qtable">
          <thead>
            <tr>
              <th style="width: 220px;">Query</th>
              <th>Description</th>
              <th style="width: 110px;">Action</th>
            </tr>
          </thead>
          <tbody id="qrows"></tbody>
        </table>

        <div id="status">Ready - click Copy, then paste into the YASGUI editor (Ctrl+V).</div>
      </div>
    </div>
  </div>

  <div id="yasgui"></div>

  <script src="/vendor/yasgui/yasgui.min.js"></script>

  <script>
    (function () {
      const ENDPOINT = "http://localhost:3030/formula1/query";
      const statusEl = document.getElementById("status");

      function setStatus(msg) { statusEl.textContent = msg; }

      const YasguiCtor = window.Yasgui || window.YASGUI || window.yasgui;
      if (!YasguiCtor) {
        setStatus("ERROR: YASGUI constructor missing. Check /vendor/yasgui/yasgui.min.js");
        return;
      }

      new YasguiCtor(document.getElementById("yasgui"), {
        persistenceId: "f1-yasgui",
        requestConfig: { endpoint: ENDPOINT }
      });

      setStatus("Ready - click Copy, then paste into YASGUI editor (Ctrl+V) and Run.");
    })();
  </script>
  <script>
    (function () {
      const NS = "http://example.org/formula1#";
      const rowsEl = document.getElementById("qrows");
      const statusEl = document.getElementById("status");

      function localNameExpr(varIri) {
        return `REPLACE(REPLACE(STRAFTER(STR(${varIri}), "#"), "_", " "), "-", " ")`;
      }

      const QUERIES = [
  {
    title: "CQ1: Which drivers competed for which constructors in each season?",
    desc: "Tests the dependency between Season, TeamEntry, Constructor, and Driver, verifying that participation relations are correctly modeled.",
    query: `
PREFIX f1: <${NS}>
SELECT ?seasonLabel ?constructorName
       (GROUP_CONCAT(DISTINCT ?driverLabel; separator=", ") AS ?drivers)
WHERE {
  ?entry a f1:TeamEntry ;
         f1:entryInSeason ?season ;
         f1:enteredBy ?constructor ;
         f1:hasMainDriver ?driver .

  BIND(${localNameExpr("?season")} AS ?seasonLabel)
  OPTIONAL { ?constructor f1:constructorName ?constructorName }
  BIND(${localNameExpr("?driver")} AS ?driverLabel)
}
GROUP BY ?seasonLabel ?constructorName
ORDER BY DESC(?seasonLabel) ?constructorName
`
  },

  {
    title: "CQ1a: Which drivers competed for which constructors in Season 2023?",
    desc: "Concrete instantiation of CQ1 for a specific season, used to validate season-specific participation data.",
    query: `
PREFIX f1: <${NS}>
SELECT ?constructorName
       (GROUP_CONCAT(DISTINCT ?driverLabel; separator=", ") AS ?drivers)
WHERE {
  ?entry a f1:TeamEntry ;
         f1:entryInSeason f1:Season2023 ;
         f1:enteredBy ?constructor ;
         f1:hasMainDriver ?driver .

  OPTIONAL { ?constructor f1:constructorName ?constructorName }
  BIND(${localNameExpr("?driver")} AS ?driverLabel)
}
GROUP BY ?constructorName
ORDER BY ?constructorName
`
  },

  {
    title: "CQ2: What is the nationality of each Formula One driver?",
    desc: "Tests the dependency between Driver and Country via the hasNationality object property.",
    query: `
PREFIX f1: <${NS}>
SELECT ?driverName ?nationalityName
WHERE {
  ?driver a f1:Driver ;
          f1:hasNationality ?country .
  BIND(${localNameExpr("?driver")} AS ?driverName)
  BIND(${localNameExpr("?country")} AS ?nationalityName)
}
ORDER BY ?nationalityName ?driverName
`
  },

  {
    title: "CQ3: Which constructors are based in which countries?",
    desc: "Verifies the dependency between Constructor and Country via the basedInCountry property.",
    query: `
PREFIX f1: <${NS}>
SELECT ?constructorName ?countryName
WHERE {
  ?constructor a f1:Constructor ;
               f1:basedInCountry ?country .
  OPTIONAL { ?constructor f1:constructorName ?constructorName }
  BIND(${localNameExpr("?country")} AS ?countryName)
}
ORDER BY ?countryName ?constructorName
`
  },

  {
    title: "CQ4: Which circuits are located in which countries?",
    desc: "Tests the geographical dependency between Circuit and Country via the locatedInCountry property.",
    query: `
PREFIX f1: <${NS}>
SELECT ?circuitName ?countryName
WHERE {
  ?circuit a f1:Circuit ;
           f1:locatedInCountry ?country .
  OPTIONAL { ?circuit f1:shortName ?circuitName }
  BIND(${localNameExpr("?country")} AS ?countryName)
}
ORDER BY ?countryName ?circuitName
`
  },

  {
    title: "CQ5: How many circuits exist per country?",
    desc: "Aggregates circuit instances by country to validate Circuit–Country coverage.",
    query: `
PREFIX f1: <${NS}>
SELECT ?countryName (COUNT(?circuit) AS ?circuitCount)
WHERE {
  ?circuit a f1:Circuit ;
           f1:locatedInCountry ?country .
  BIND(${localNameExpr("?country")} AS ?countryName)
}
GROUP BY ?countryName
ORDER BY DESC(?circuitCount)
`
  },

  {
    title: "CQ6: What is the declared class hierarchy of the ontology?",
    desc: "Verifies the conceptual taxonomy using rdfs:subClassOf relations.",
    query: `
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT ?child ?parent
WHERE {
  ?child rdfs:subClassOf ?parent
}
ORDER BY STR(?parent) STR(?child)
`
  },

  {
    title: "CQ7: What object properties define the ontology's relational structure?",
    desc: "Lists object properties with domains and ranges to validate modeled dependencies.",
    query: `
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT ?property ?domain ?range
WHERE {
  ?property a owl:ObjectProperty .
  OPTIONAL { ?property rdfs:domain ?domain }
  OPTIONAL { ?property rdfs:range ?range }
}
ORDER BY STR(?property)
`
  },

  {
    title: "CQ8: Driver season totals (points and wins)",
    desc: "Shows aggregated points and wins per driver and season.",
    query: `
PREFIX f1: <${NS}>
SELECT ?year ?driverName ?wins ?points
WHERE {
  ?standing a f1:Standing ;
            f1:partOfSeason ?season ;
            f1:hasStandingRow ?row .
  ?row f1:rowForDriver ?driver ;
       f1:totalPoints ?points ;
       f1:winsCount ?wins .
  BIND(REPLACE(STR(?season), "^.*Season", "") AS ?year)
  BIND(${localNameExpr("?driver")} AS ?driverName)
}
ORDER BY ?year DESC(?points) DESC(?wins) ?driverName
`
  },

  {
    title: "CQ9: Which drivers scored the most points overall?",
    desc: "Sums totalPoints across all seasons for each driver.",
    query: `
PREFIX f1: <${NS}>
SELECT ?driverName (SUM(?points) AS ?totalPoints)
WHERE {
  ?row a f1:StandingRow ;
       f1:rowForDriver ?driver ;
       f1:totalPoints ?points .
  BIND(${localNameExpr("?driver")} AS ?driverName)
}
GROUP BY ?driverName
ORDER BY DESC(?totalPoints)

`
  },

  {
    title: "CQ10: Which drivers have the most wins overall?",
    desc: "Sums winsCount across all seasons for each driver.",
    query: `
PREFIX f1: <${NS}>
SELECT ?driverName (SUM(?wins) AS ?totalWins)
WHERE {
  ?row a f1:StandingRow ;
       f1:rowForDriver ?driver ;
       f1:winsCount ?wins .
  BIND(${localNameExpr("?driver")} AS ?driverName)
}
GROUP BY ?driverName
ORDER BY DESC(?totalWins)

`
  },

  {
    title: "CQ11: How many drivers scored points each season?",
    desc: "Counts drivers with totalPoints > 0 per season.",
    query: `
PREFIX f1: <${NS}>
SELECT ?year (COUNT(DISTINCT ?driver) AS ?driversWithPoints)
WHERE {
  ?standing a f1:Standing ;
            f1:partOfSeason ?season ;
            f1:hasStandingRow ?row .
  ?row f1:rowForDriver ?driver ;
       f1:totalPoints ?points .
  FILTER(?points > 0)
  BIND(REPLACE(STR(?season), "^.*Season", "") AS ?year)
}
GROUP BY ?year
ORDER BY ?year

`
  },

  {
    title: "CQ12: Which drivers scored points without winning a race?",
    desc: "Lists drivers with points but zero wins in a season.",
    query: `
PREFIX f1: <${NS}>
SELECT ?year ?driverName ?points
WHERE {
  ?standing a f1:Standing ;
            f1:partOfSeason ?season ;
            f1:hasStandingRow ?row .
  ?row f1:rowForDriver ?driver ;
       f1:totalPoints ?points ;
       f1:winsCount 0 .
  FILTER(?points > 0)
  BIND(REPLACE(STR(?season), "^.*Season", "") AS ?year)
  BIND(${localNameExpr("?driver")} AS ?driverName)
}
ORDER BY ?year DESC(?points) ?driverName

`
  },

  {
    title: "CQ13: What cardinality constraints are defined in the ontology?",
    desc: "Lists OWL restriction constraints (min/max/cardinality) on classes.",
    query: `
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT ?class ?property ?type ?value
WHERE {
  ?class rdfs:subClassOf ?restriction .
  ?restriction a owl:Restriction ;
               owl:onProperty ?property .
  OPTIONAL { ?restriction owl:cardinality ?value BIND("cardinality" AS ?type) }
  OPTIONAL { ?restriction owl:minCardinality ?value BIND("minCardinality" AS ?type) }
  OPTIONAL { ?restriction owl:maxCardinality ?value BIND("maxCardinality" AS ?type) }
}
ORDER BY ?class ?property ?type

`
  }
];


      async function copyToClipboard(text) {
        if (navigator.clipboard) return navigator.clipboard.writeText(text);
        const ta = document.createElement("textarea");
        ta.value = text;
        ta.style.position = "fixed";
        ta.style.top = "-9999px";
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
      }

      function addRow(q, idx) {
        const tr = document.createElement("tr");

        const td1 = document.createElement("td");
        td1.innerHTML = `<strong>${q.title}</strong><div class="smallMuted">#${idx + 1}</div>`;

        const td2 = document.createElement("td");
        td2.textContent = q.desc;

        const td3 = document.createElement("td");
        const b = document.createElement("button");
        b.className = "copyBtn";
        b.textContent = "Copy";
        b.onclick = async () => {
          await copyToClipboard(q.query);
          statusEl.textContent = `Copied - ${q.title} - paste into YASGUI and Run.`;
        };
        td3.appendChild(b);

        tr.append(td1, td2, td3);
        rowsEl.appendChild(tr);
      }

      rowsEl.innerHTML = "";
      QUERIES.forEach(addRow);
    })();
  </script>
</body>
</html>







